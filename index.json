[{"content":"CzeÅ›Ä‡. W dzisiejszym artykule chciaÅ‚bym poruszyÄ‡ temat architektury heksagonalnej znanej rÃ³wnieÅ¼ jako architektura PortÃ³w i AdapterÃ³w (ang. Ports \u0026amp; Adapters). Mam nadziejÄ™, Å¼e uda mi siÄ™ przedstawiÄ‡ Tobie w prosty sposÃ³b jak zaimplementowaÄ‡ architekturÄ™ heksagonalnÄ… w Twoim projekcie. Ale zacznijmy od poczÄ…tku.\nCzym jest hexagonal architecture? Architektura heksagonalna to wzorzec architektoniczny, ktÃ³ry pozwala na implementacjÄ™ logiki biznesowej, caÅ‚kowicie odseparowanej od zaleÅ¼noÅ›ci. IntencjÄ… architektury heksagonalnej jest moÅ¼liwoÅ›Ä‡ wykorzystania napisanej aplikacji przez dowolne wejÅ›cie (np. UI, aplikacja konsolowa lub API),a takÅ¼e testÃ³w automatycznych. WykorzystujÄ…c porty i adaptery mamy moÅ¼liwoÅ›Ä‡ prostego uruchomienia testÃ³w w izolacji od zewnÄ™trznych serwisÃ³w lub usÅ‚ug (np. bazy danych).\nAllow an application to equally be driven by users, programs, automated test or batch scripts, and to be developed and tested in isolation from its eventual run-time devices and databases.\n\u0026ndash; Alistair Cockburn\nZ zaÅ‚oÅ¼enia koncept ten pozwala na modularyzacjÄ™ aplikacji, a co za tym idzie, na bezproblemowÄ… zmianÄ™ komponentÃ³w. Pozwala rÃ³wnieÅ¼ na Å‚atwÄ… implementacjÄ™ nowego interfejsu uÅ¼ytkownikam, jak na przykÅ‚ad dodanie REST API lub po prostu Å‚atwe testowanie domeny biznesowej z wykorzystaniem StubÃ³w lub MockÃ³w.\nInnymi sÅ‚owy odseparowujemy implementacjÄ™ logiki biznesowej od zewnÄ™trznych zaleÅ¼noÅ›ci.\nDziÄ™ki wykorzystaniu konceptu architektury heksagonalnej unikamy przenikania logiki biznesowej do interfejsu uÅ¼ytkownika, a kod jest Å‚atwiejszy do przetestowania.\nNa czym polega caÅ‚a â€magiaâ€ portÃ³w i adapterÃ³w? To bardzo proste, wykorzystuje podstawowy element programowania obiektowego â€“ interfejsy oraz reguÅ‚Ä™ odwrÃ³conych zaleÅ¼noÅ›ci (ang. dependency inversion principle).\nDobrze, poznaliÅ›my juÅ¼ podstawy architektury, teraz moÅ¼emy przejÅ›Ä‡ do â€miÄ™saâ€ hexagonu!\nJak wyglÄ…da struktura? Architektura portÃ³w i adapterÃ³w bazuje na modelu warstwowym i dzieli siÄ™ na dwie warstwy â€“ Domeny i Infrastruktury. W przeciwieÅ„stwie do architektury warstwowej, w ktÃ³rej w zaleÅ¼noÅ›ci od wizualizacji kierunek zaleÅ¼noÅ›ci biegnie z gÃ³ry na dÃ³Å‚ lub inaczej z zewnÄ…trz do Å›rodka, w architekturze heksagonalnej kierunek zaleÅ¼noÅ›ci biegnie od Domeny na zewnÄ…trz. W architekturze heksagonalnej oprÃ³cz warstw wyrÃ³Å¼niamy jeszcze porty i adaptery, za pomocÄ… ktÃ³rych komunikujemy siÄ™ miÄ™dzy warstwami.\nPorty i adaptery z kolei dzielimy wejÅ›ciowe oraz wyjÅ›ciowe na kaÅ¼dym z bokÃ³w umownego heksagonu.\nPort rozumiany jest jako interfejs wejÅ›ciowy do aplikacji. PrzykÅ‚adowo moÅ¼e byÄ‡ to request HTTP, ktÃ³ry uruchamia Å¼Ä…danie do naszej aplikacji. Port rÃ³wnieÅ¼ rozumiany jest jako dostÄ™p do danych, np port bazy danych. Z drugiej strony mamy adaptery, czyli coÅ› co dopasowuje siÄ™ do portu\nTechnicznie port rozumiany jest jako interfejs, a adapter to jego implementacja. To trochÄ™ jak z USB, ktÃ³ry jest umownym interfejsem i producenci dostosowujÄ… do niego swoje urzÄ…dzenia. W programistycznym Å›wiecie mamy przykÅ‚ad portu Repozytorium. Zawiera ono metodÄ™, ktÃ³ra powinna zwrÃ³ciÄ‡ tablicÄ™ obiektÃ³w danej klasy. Jak moÅ¼e wyglÄ…daÄ‡ tutaj adapter? Z punktu widzenia domeny nie ma to kompletnie Å¼adnego znaczenia. W zaleÅ¼noÅ›ci od potrzeby moÅ¼emy wykorzystaÄ‡ tutaj implementacjÄ™ za pomocÄ… natywnych zapytaÅ„ do bazy danych lub z wykorzystaniem abstrakcji, np. Doctrine. Jednak to nie musi byÄ‡ silnik bazy danych, a na przykÅ‚ad zewnÄ™trzna usÅ‚uga z interfejsem API. IdÄ…c dalej, moÅ¼e to byÄ‡ jeden z naszych mikroserwisÃ³w lub po prostu plik tekstowy.\n1 2 3 4 5 6 7 \u0026lt;?php interface CustomerRepository { /** @return Customer[] */ public function findAll(): array; } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;?php class CustomerMysqlRepository implements CustomerRepository { /** @return SomeClass[] */ public function findAll(): array { $stmt = $this-\u0026gt;connection-\u0026gt;prepare(\u0026#39;SELECT uuid, name FROM user\u0026#39;); $stmt-\u0026gt;exec(); $result = [] foreach($row = $stmt-\u0026gt;fetch()) { $result[] = new Customer($row[\u0026#39;uuid\u0026#39;], $row[\u0026#39;name\u0026#39;]); } return $result } } 1 2 3 4 5 6 7 8 9 \u0026lt;?php class CustomerDoctrineRepository implements CustomerRepository { /** @return Customer[] */ public function findAll(): array { return $this-\u0026gt;findBy([]); } } Potrzebujesz wysÅ‚aÄ‡ powiadomienie? Nie ma problemu, jedyne co musisz utworzyÄ‡ to interfejs w warstwie domeny oraz jego implementacje w zewnÄ™trznej warstwie.\nNa koniec bardzo waÅ¼na rzecz, warstwa domeny nie powinna zaleÅ¼eÄ‡ od Å¼adnych zewnÄ™trznych zaleÅ¼noÅ›ci.\n","permalink":"https://g-stawarczyk.github.io/2021/01/architektura-heksagonalna/","summary":"CzeÅ›Ä‡. W dzisiejszym artykule chciaÅ‚bym poruszyÄ‡ temat architektury heksagonalnej znanej rÃ³wnieÅ¼ jako architektura PortÃ³w i AdapterÃ³w (ang. Ports \u0026amp; Adapters). Mam nadziejÄ™, Å¼e uda mi siÄ™ przedstawiÄ‡ Tobie w prosty sposÃ³b jak zaimplementowaÄ‡ architekturÄ™ heksagonalnÄ… w Twoim projekcie. Ale zacznijmy od poczÄ…tku.\nCzym jest hexagonal architecture? Architektura heksagonalna to wzorzec architektoniczny, ktÃ³ry pozwala na implementacjÄ™ logiki biznesowej, caÅ‚kowicie odseparowanej od zaleÅ¼noÅ›ci. IntencjÄ… architektury heksagonalnej jest moÅ¼liwoÅ›Ä‡ wykorzystania napisanej aplikacji przez dowolne wejÅ›cie (np.","title":"Architektura Heksagonalna"},{"content":"CzeÅ›Ä‡. W tym artykule skupimy siÄ™ na zapisywaniu Value Objectâ€™Ã³w w bazie danych. JeÅ¼eli nie wiesz czym jest Obiekt WartoÅ›ci, to zapraszam CiÄ™ do mojego poprzedniego artykuÅ‚u: Value Object â€“ Podstawowy element Domain Driven Design. Tymczasem przejdÅºmy do meritum.\nNa poczÄ…tek naleÅ¼y uzupeÅ‚niÄ‡ poprzedni artykuÅ‚, iÅ¼ Value Object naleÅ¼y do Encji i nigdy nie jest zapisywany w bazie danych samemu sobie. Zazwyczaj zapisujemy je poprzez Agregat, o ktÃ³rym napiszÄ™ w kolejnym artykule. Istnieje kilka sposobÃ³w na zapis obiektu wartoÅ›ci w bazie danych.\nW Å›wiecie PHP istnieje wiele narzÄ™dzi ORM, ktÃ³re pomagajÄ… nam w codziennej pracy z bazami danych. Nie mniej jednak, w tym artykule skupiÄ™ siÄ™ jedynie na Doctrine, poniewaÅ¼ znam go najlepiej oraz wÅ‚asnej implementacji ORM na podstawie Doctrine DBAL.\nObiekt wartoÅ›ci we wÅ‚asnym ORM JeÅ¼eli implementujemy wÅ‚asne narzÄ™dzie ORM, musimy sami zadbaÄ‡ o wszystkie szczegÃ³Å‚y, ktÃ³re pozwolÄ… nam wspÃ³Å‚pracowaÄ‡ z bazami danych. Na przykÅ‚adzie relacyjnej bazy danych MySQL, musimy utworzyÄ‡ schemat tabeli Encji, ktÃ³rÄ… bÄ™dziemy zapisywaÄ‡. Nasza przykÅ‚adowa Encja to Person zawierajÄ…ca ImiÄ™ i Nazwisko jako Value Object, datÄ™ urodzenia oraz PESEL jako identyfikator.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 \u0026lt;?php declare(strict_types=1); final class Person { private string $id; private Name $name; private DateTimeImmutable $birthDate; public function __construct(string $id, Name $name, DateTimeImmutable $birthDate) { $this-\u0026gt;id = $id; $this-\u0026gt;name = $name; $this-\u0026gt;birthDate = $birthDate; } } final class Name { private string $first; private string $last; public function __construct(string $first, string $last) { $this-\u0026gt;first = $first; $this-\u0026gt;last = $last; } public function first(): string { return $this-\u0026gt;firstName; } public function last(): string { return $this-\u0026gt;lastName; } } DobrÄ… praktykÄ… jest utrzymywanie identyfikatora rÃ³wnieÅ¼ jako Value Object, ale dla uproszczenia pominiemy ten aspekt. ObsÅ‚ugÄ™ Value Objectâ€™u jako identyfikator Encji omÃ³wimy w innym artykule.\nNa poczÄ…tek musimy utworzyÄ‡ odpowiedni schemat:\n1 2 3 4 5 6 7 8 9 10 create table person ( id char(11) not null, name_first varchar(255) not null, name_last varchar(255) not null, date_birth date not null ); create unique index person_id_uindex on person (id); AnalizujÄ…c powyÅ¼szÄ… kwerendÄ™ SQL, moÅ¼esz zauwaÅ¼yÄ‡, Å¼e Encja posiada 3 pola, a tabela w bazie danych 4. Wynika to z faktu, Å¼e nasz Value Object posiada w sobie 2 pola, ktÃ³re zostaÅ‚y oznaczone odpowiednio prefiksem name_ w tabeli bazy danych. Aby zapisaÄ‡ utworzonÄ… encjÄ™ w bazie, utwÃ³rzmy przykÅ‚adowe repozytorium, ktÃ³re wykona zapytanie INSERT do bazy.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php declare(strict_types=1); final class PersonDbalRepository extends DbalRepository implements PersonRepository { public function save(Person $person): void { $sql = \u0026#39;INSERT INTO person (id, name_first, name_last, birth_date) VALUES (?, ?, ?, ?);\u0026#39;; $stmt = $this-\u0026gt;connection()-\u0026gt;prepare($sql); $stmt-\u0026gt;bindValue(1, $person-\u0026gt;getId()); $stmt-\u0026gt;bindValue(2, $person-\u0026gt;getName()-\u0026gt;first()); $stmt-\u0026gt;bindValue(3, $person-\u0026gt;getName()-\u0026gt;last()); $stmt-\u0026gt;bindValue(4, $person-\u0026gt;getBirthDate()-\u0026gt;format(\u0026#39;Y-m-d\u0026#39;)); $stmt-\u0026gt;execute(); } } To wszystko, nasza encja zostaÅ‚a zapisana w bazie danych. Teraz tylko pozostaÅ‚o nam odczytaÄ‡ wiersz z bazy danych i zmaapowaÄ‡ go na obiekt Encji oraz Value Objectu\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 \u0026lt;?php declare(strict_types=1); final class PersonDbalRepository extends DbalRepository implements PersonRepository { // ... public function find(string $id): Person { $sql = \u0026#39;SELECT * FROM person WHERE id = ?\u0026#39;; $stmt = $this-\u0026gt;connection()-\u0026gt;prepare($sql); $stmt-\u0026gt;bindValue(1, $id); $result = $stmt-\u0026gt;execute(); // ... return new Person( $row[\u0026#39;id\u0026#39;], new Name($row[\u0026#39;name_first\u0026#39;], $row[\u0026#39;name_last\u0026#39;]), DateTimeImmutable::createFromFormat(\u0026#39;Y-m-d\u0026#39;, $row[\u0026#39;birth_date\u0026#39;]) ); } } Proste, prawda? Niestety niesie to za sobÄ… kilka konsekwencji. Przy kaÅ¼dym odczycie danych z bazy, wywoÅ‚any bÄ™dzie konstruktor obiektÃ³w, ktÃ³ry bardzo czÄ™sto bÄ™dzie zawieraÅ‚ logikÄ™ walidacji. Spowoduje to wydÅ‚uÅ¼enie czasu tworzenia obiektÃ³w. To jednak nie jest jeszcze takie zÅ‚e. WyobraÅºmy sobie, Å¼e w konstruktorze Encji ktÃ³rÄ… tworzymy, wysyÅ‚amy zdarzenie domenowe: Osoba zostaÅ‚a utworzona (Tak wiem, dziwnie to brzmi :D). Za kaÅ¼dym raziem, gdy bÄ™dziemy odczytywaÄ‡ obiekt z bazy danych, zdarzenie zostanie wysÅ‚ane i nie jest to poprawne zachowanie. Dlatego warto korzystaÄ‡ z gotowych i sprawdzonych narzÄ™dzi takich jak Doctrine, ktÃ³ry tworzy nowy obiekt bezwykorzystania konstruktora.\nValue Object w Doctrine Zapisywanie Obiektu wartoÅ›ci za pomocÄ… Doctrine moÅ¼na wykonaÄ‡ na 3 sposoby. Pierwszym z nich i chyba najÅ‚atwiejszym jest rÄ™czne tworzenie Obiektu WartoÅ›ci w metodzie get lub odpowiednie przypisanie do pÃ³l encji podczas wykonania metody set czy w konstruktorze.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 \u0026lt;?php declare(strict_types=1); final class Name { private string $first; private string $last; public function __construct(string $first, string $last) { $this-\u0026gt;first = $first; $this-\u0026gt;last = $last; } public function first(): string { return $this-\u0026gt;first; } public function last(): string { return $this-\u0026gt;last; } } /** @Entity */ final class Person { /** * @Id * @Column(name=\u0026#34;id\u0026#34;, type=\u0026#34;string\u0026#34;, length=11) * @GeneratedValue(strategy=\u0026#34;NONE\u0026#34;) */ private string $id; /** @ORM\\Column(type=\u0026#34;string\u0026#34;) */ private string $nameFirst; /** @ORM\\Column(type=\u0026#34;string\u0026#34;) */ private string $nameLast; /** @ORM\\Column(type=\u0026#34;string\u0026#34;) */ private DateTimeImmutable $birthDate; public function __construct(string $id, Name $name, DateTimeImmutable $birthDate) { $this-\u0026gt;id = $id; $this-\u0026gt;name_first = $name-\u0026gt;first(); $this-\u0026gt;name_last = $name-\u0026gt;last(); $this-\u0026gt;birthDate = $birthDate; } public function getName(): Name { return new Name($this-\u0026gt;name_first, $this-\u0026gt;name_last); } } Proste i szybkie rozwiÄ…zanie, jednak mamy odrobinÄ™ wiÄ™cej kodu do utrzymania.\nEmbeddables Drugim sposobem jest wykorzystanie mechanizmu Embedded. Na poczÄ…tek wyrzuÄ‡my pola $name_first oraz $name_last na rzecz jednego pola $name oraz dodajmy mapping encji. Dla uproszczenia jako adnotacje:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 \u0026lt;?php declare(strict_types=1); /** @Embeddable */ final class Name { /** @ORM\\Column(type=\u0026#34;string\u0026#34;) */ private string $first; /** @ORM\\Column(type=\u0026#34;string\u0026#34;) */ private string $last; public function __construct(string $first, string $last) { $this-\u0026gt;first = $first; $this-\u0026gt;last = $last; } public function first(): string { return $this-\u0026gt;first; } public function last(): string { return $this-\u0026gt;last; } } /** @Entity */ final class Person { /** * @Id * @Column(name=\u0026#34;id\u0026#34;, type=\u0026#34;string\u0026#34;, length=11) * @GeneratedValue(strategy=\u0026#34;NONE\u0026#34;) */ private string $id; /** @Embedded(class=\u0026#34;Name\u0026#34;) */ private Name $name; /** @ORM\\Column(type=\u0026#34;string\u0026#34;) */ private DateTimeImmutable $birthDate; public function __construct(string $id, Name $name, DateTimeImmutable $birthDate) { $this-\u0026gt;id = $id; $this-\u0026gt;name = $name; $this-\u0026gt;birthDate = $birthDate; } public function getName(): Name { return $this-\u0026gt;name; } } SpÃ³jrz proszÄ™ na liniÄ™ 3 oraz 37. W linii 3 oznaczyliÅ›my naszÄ… klasÄ™ jako Embeddable, dziÄ™ki czemu Doctrine wie, Å¼e jest to Value Object, ktÃ³ry bÄ™dzie wykorzystywany w Encji. Tak wÅ‚aÅ›nie zrobiliÅ›my, w linii 37 oznaczyliÅ›my pole $name adnotacjÄ™ Embedded, ktÃ³ra mÃ³wi, Å¼e to pole jest Value Objectâ€™em o podanej klasie. Doctrine z tak skonfigurowanÄ… EncjÄ… podczas odczytywania, przy wykorzystaniu swojej implementacji EntityRepository, utworzy nam poprawny obiekt Person z polem $name jako Value Object.\nProste, prawda? Niestety to rozwiÄ…zanie ma swoje minusy. W wersji Doctrine/ORM 2.x pole Embedded nie moÅ¼e byÄ‡ nullâ€™em. Prawdopodobnie Embbeded bÄ™dzie mogÅ‚o byÄ‡ nullem w wersja 3.x, ktÃ³ra na dzieÅ„ pisania postu jest jeszcze w fazie developmentu.\nJak poradziÄ‡ sobie z tym problemem? Albo wybieramy sposÃ³b pierwszy opisany wyÅ¼ej, albo wybieramy sposÃ³b trzeci. Spoiler ALERT! Jednak juÅ¼ na poczÄ…tku muszÄ™ CiÄ™ uprzedziÄ‡, Å¼e i to rozwiÄ…zanie ma swÃ³j minus. Niestety w naszym opisywanym przypadku, niestety nie pozwala on na implementacjÄ™ obiektu Name jako Value Object w naszej Encji.\nTen sposÃ³b to WÅ‚asny Typ (ang. Custom Mapping Type). Sama implementacja jest rÃ³wnieÅ¼ doÅ›Ä‡ prosta i co waÅ¼ne, pozwala na uÅ¼ycie opcji nullable.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;?php declare(strict_types=1); use Doctrine\\DBAL\\Types\\Type; use Doctrine\\DBAL\\Platforms\\AbstractPlatform; class MyType extends Type { const MYTYPE = \u0026#39;mytype\u0026#39;; // modify to match your type name public function getSQLDeclaration(array $fieldDeclaration, AbstractPlatform $platform) { // return the SQL used to create your column type. To create a portable column type, use the $platform. } public function convertToPHPValue($value, AbstractPlatform $platform) { // This is executed when the value is read from the database. Make your conversions here, optionally using the $platform. } public function convertToDatabaseValue($value, AbstractPlatform $platform) { // This is executed when the value is written to the database. Make your conversions here, optionally using the $platform. } public function getName() { return self::MYTYPE; // modify to match your constant name } } Tak wyglÄ…da szablon implementacji wÅ‚asnego typu w dokumentacji Doctrine.\nJak poprawnie zaimplementowaÄ‡ custom mapping type? Tym zajmiemy siÄ™ w kolejnym artykule, w ktÃ³rym opiszemy jak uÅ¼yÄ‡ Value Object jako identyfikator. Z tego miejsca zapraszam CiÄ™ do Å›ledzenia mojego bloga.\n","permalink":"https://g-stawarczyk.github.io/2020/12/persystencja-value-object-w-php/","summary":"CzeÅ›Ä‡. W tym artykule skupimy siÄ™ na zapisywaniu Value Objectâ€™Ã³w w bazie danych. JeÅ¼eli nie wiesz czym jest Obiekt WartoÅ›ci, to zapraszam CiÄ™ do mojego poprzedniego artykuÅ‚u: Value Object â€“ Podstawowy element Domain Driven Design. Tymczasem przejdÅºmy do meritum.\nNa poczÄ…tek naleÅ¼y uzupeÅ‚niÄ‡ poprzedni artykuÅ‚, iÅ¼ Value Object naleÅ¼y do Encji i nigdy nie jest zapisywany w bazie danych samemu sobie. Zazwyczaj zapisujemy je poprzez Agregat, o ktÃ³rym napiszÄ™ w kolejnym artykule.","title":"Persystencja Value Object w PHP"},{"content":"Podczas programowania obiektowego bardzo czÄ™sto wykorzystujemy typy primitywne do przedstawienia jakiejÅ› wartoÅ›ci. Przy tym bardzo czÄ™sto musimy zmierzyÄ‡ siÄ™ z przekazywaniem oraz modyfikacjÄ… tych wartoÅ›ci. IdÄ…c dalej, chcemy mieÄ‡ przecieÅ¼ poprawne dane, wiÄ™c sprawdzamy ich poprawnoÅ›Ä‡ dodajÄ…c dodatkowÄ… logikÄ™ walidujÄ…cÄ…. A co w sytuacji, gdy danÄ… wartoÅ›Ä‡, ktÃ³ra reprezentuje jakiÅ› koncept, chcemy wykorzystaÄ‡ w wiÄ™cej niÅ¼ jednym miejscu? Duplikujemy logikÄ™ sprawdzania ich poprawnoÅ›ci? Wybieramy specjalne miejsce aby utworzyÄ‡ klasÄ™ walidacji, a moÅ¼e duplikujemy kod? CiÄ™Å¼ki temat, szczegÃ³lnie w pÃ³Åºniejszym utrzymaniu, ale tutaj z pomocÄ… przychodzi nam Value Object (obiekt wartoÅ›ci, wartoÅ›Ä‡).\nCzym jest Value Object Value Object jest to prosty obiekt, ktÃ³ry reprezentuje zmierzonÄ…, wyliczonÄ… lub opisanÄ… wartoÅ›Ä‡. SÄ… to zazwyczaj bardzo maÅ‚e obiekty takie jak zakres dat, pieniÄ…dz czy inne proste wartoÅ›ci jak identyfikator Encji. Jednak co waÅ¼ne, w odrÃ³Å¼nieniu od Encji, nie posiadajÄ… toÅ¼samoÅ›ci.\nCzym jest toÅ¼samoÅ›Ä‡ obiektu? W bardzo duÅ¼ym skrÃ³cie jest to identyfikator, ktÃ³ry nadajemy.\nMoÅ¼emy sobie zadaÄ‡ pytanie, czy obiekt wartoÅ›ci w jednym projekcie moÅ¼e byÄ‡ bez problemu zawsze obiektem wartoÅ›ci w innym projekcie? Nie. Bardzo dobrym przykÅ‚adem jest wÅ‚aÅ›nie reprezentacja PieniÄ…dza. Z jednej strony, dla wiÄ™kszoÅ›ci dwa banknoty 10 zÅ‚ sÄ… rÃ³wne jeÅ¼eli ich nominaÅ‚y siÄ™ zgadzajÄ…. Jednak dla Banku Centralnego bardzo waÅ¼nÄ… informacjÄ… jest numer seryjny banknotu. W takim przypadku nie bÄ™dzie to juÅ¼ Obiekt WartoÅ›ci a Encja.\nW powyÅ¼szym przykÅ‚adzie moÅ¼na zauwaÅ¼yÄ‡ rÃ³Å¼nicÄ™ w porÃ³wnywaniu WartoÅ›ci oraz Encji. Obiekty wartoÅ›ci sÄ… rÃ³wne, jeÅ¼eli ich zmierzone, wyliczone lub opisane wartoÅ›ci sÄ… rÃ³wne. Encje zaÅ› porÃ³wnujemy za pomocÄ… identyfikatorÃ³w.\nCharakterystyka ObiektÃ³w WartoÅ›ci MierzÄ…, liczÄ… lub opisujÄ… Jedna z podstawowych cech Value Object jest opisywanie, wyliczanie czy mierzenie wartoÅ›ci. WÅ‚aÅ›nie wartoÅ›Ä‡ to sÅ‚owo klucz. Value Object nie jest rzeczÄ… w domenie, a wÅ‚aÅ›nie wartoÅ›ciÄ…. W podanym wczeÅ›niej przykÅ‚adzie pieniÄ…dza, utworzony Value Object nie przedstawia pieniÄ…dza jako rzecz, a mierzy iloÅ›Ä‡ okreÅ›lonej waluty. SzukajÄ…c innych przykÅ‚adÃ³w wartoÅ›ci moÅ¼emy znaleÅºÄ‡ ImiÄ™, Nazwisko lub Adres. Jednak zawsze musimy pamiÄ™taÄ‡, Å¼e wszystko zaleÅ¼y od kontekstu. W jednym systemie Adres moÅ¼e byÄ‡ Value Objectem, a w innym bÄ™dzie musiaÅ‚ byÄ‡ EncjÄ….\nNiezmiennoÅ›Ä‡ i Side-Effect-Free NiezmiennoÅ›Ä‡ (ang. Immutability), to kolejna waÅ¼na cecha wartoÅ›ci. Nie moÅ¼emy dopuÅ›ciÄ‡ aby Value Object w swoim cyklu Å¼ycia zmieniÅ‚ swÃ³j stan. RÃ³wnieÅ¼ musimy mieÄ‡ na uwadze fakt, Å¼e obiekt ten musi byÄ‡ zawsze w poprawnym stanie.\nJak utworzyÄ‡ taki obiekt, aby byÅ‚ niezmienny? Jednym z najprostszych sposobÃ³w jest moÅ¼liwoÅ›Ä‡ tworzenia obiektÃ³w tylko przez konstruktor, a sam obiekt jest pozbawiony metod zmieniajÄ…cych stan.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;?php declare(strict_types=1); final class ValueObject { private string $value; public function __construct(string $value) { $this-\u0026gt;value = $value; } public function value(): string { return $this-\u0026gt;value; } } W prawdzie moÅ¼na tutaj zarzuciÄ‡, Å¼e nie mamy tutaj w 100% zabezpieczenia przed zmianÄ… stanu, bo przecieÅ¼ w PHP konstruktor moÅ¼e byÄ‡ odpalony kilka razy, a co za tym idzie? WartoÅ›Ä‡ siÄ™ zmieni\n1 2 3 4 5 6 $value = new ValueObject(\u0026#39;foo\u0026#39;); var_dump($value-\u0026gt;value()); // foo $value-\u0026gt;__construct(\u0026#39;bar\u0026#39;); var_dump($value-\u0026gt;value()); // bar UmÃ³wmy siÄ™ jednak, kto taki coÅ› robi? Gdyby jednak ktoÅ› chciaÅ‚ siÄ™ przed tym zabezpieczyÄ‡, to jednym z dobrych rozwiÄ…zaÅ„ jest wykorzystanie metody fabrycznej. RozwiÄ…zanie jest bardzo proste i wystarczy zmieniÄ‡ publiczny konstruktor na prywatny i dodaÄ‡ statycznÄ… metodÄ™, ktÃ³ra zwrÃ³ci nowÄ… instancjÄ™ obiektu.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;?php declare(strict_types=1); final class ValueObject { private string $value; private function __construct(string $value) { $this-\u0026gt;value = $value; } public static function fromString(string $value): self { return new self($value); } public function value(): string { return $this-\u0026gt;value; } } Teraz prÃ³bujÄ…c utworzyÄ‡ nowy obiekt za pomocÄ… new otrzymamy ostrzeÅ¼enie:\n1 2 3 $value = new ValueObject(\u0026#39;foo\u0026#39;); Warning: Uncaught Error: Call to private ValueObject::__construct() from invalid context in Jak wszyscy wiemy jedynÄ… rzeczÄ… staÅ‚a w naszych systemach jest wÅ‚aÅ›nie zmiana. JeÅ¼eli mamy utrzymaÄ‡ nasz obiekt niezmiennym, jak w takim razie poradziÄ‡ sobie z operacjami zmieniajÄ…cymi stan. Tutaj rÃ³wnieÅ¼ rozwiÄ…zanie jest bardzo proste -\u0026gt; naleÅ¼y utworzyÄ‡ nowÄ… instancjÄ™ obiektu. Value Object nie moÅ¼e posiadaÄ‡ metod typu set. To wszystko oznacza, Å¼e nie zmieniasz wartoÅ›ci istniejÄ…cego juÅ¼ obiektu, tylko otrzymujesz nowy obiekt wartoÅ›ci.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;?php declare(strict_types=1); final class ValueObject { private int $value; public function __construct(int $value) { $this-\u0026gt;value = $value; } public function add(int $value): self { return new self($this-\u0026gt;value + $value); } public function value(): int { return $this-\u0026gt;value; } } PorÃ³wnywalnoÅ›Ä‡ wartoÅ›ci Value Objecty moÅ¼emy jak kaÅ¼dy inny obiekt porÃ³wnywaÄ‡ ze sobÄ…. Musimy natomiast pamiÄ™taÄ‡, Å¼e rÃ³wnoÅ›Ä‡ wartoÅ›ci wystÄ™puje wtedy, gdy wartoÅ›ci obu obiektÃ³w sÄ… takie same. Nie ma tutaj znaczenia, Å¼e jest to inna instancja klasy, waÅ¼ne jest jakÄ… wartoÅ›Ä‡ ze sobÄ… niesie.\nIstnieje kilka sposobÃ³w porÃ³wnywania wartoÅ›ci. NajprostszÄ…, a zarazem najmniej polecanÄ… jest uÅ¼ycie operatora przyrÃ³wnania ==. Dwa obiekty bÄ™dÄ… rÃ³wne jeÅ¼eli ich klasy oraz wartoÅ›ci sÄ… identyczne.\n1 2 3 4 5 6 7 8 9 10 11 $value1 = new ValueObject(10); $value2 = new ValueObject(10); var_dump($value1 == $value2); // true $value1 = new ValueObject(10); $value2 = new ValueObject(9); var_dump($value1 == $value2); // false OsobiÅ›cie jednak nie jestem fanem porÃ³wnania za pomocÄ… == i gdy tylko widzÄ™ takie porÃ³wnanie w legacy code, staram siÄ™ je zmieniÄ‡ na operator identycznoÅ›ci ===. Operator ten jednak nie nadal siÄ™ do porÃ³wnywania obiektÃ³w, poniewaÅ¼ aby obiekty byÅ‚y rÃ³wne, muszÄ… odnosiÄ‡ siÄ™ do tego samego obiektu w pamiÄ™ci.\n1 2 3 4 5 6 7 8 9 10 11 $value1 = new ValueObject(10); $value2 = new ValueObject(10); var_dump($value1 === $value2); // false $value1 = new ValueObject(10); $value2 = $value1; var_dump($value1 === $value2); // true DrugÄ… i chyba najbardziej polecanÄ… opcjÄ… na porÃ³wnywanie wartoÅ›ci jest utworzenie dedykowanej metody, ktÃ³ra porÃ³wna nam obiekty. MetodÄ™ takÄ… implementujemy w Value Object i jako argument podajemy obiekt tej samej klasy. Sama metoda w sobie jest bardzo prosta, gdyÅ¼ za pomocÄ… operatora identycznoÅ›ci porÃ³wnuje wartoÅ›Ä‡ aktualnego obiektu z wartoÅ›ciÄ… drugiego obiektu. WaÅ¼na uwaga, jeÅ¼eli nasz obiekt posiada wiÄ™cej niÅ¼ 1 wartoÅ›Ä‡, naleÅ¼y porÃ³wnaÄ‡ wszystkie wartoÅ›ci.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;?php declare(strict_types=1); final class ValueObject { private int $value; public function __construct(int $value) { $this-\u0026gt;value = $value; } public function equals(ValueObject $value): bool { return $this-\u0026gt;value === $value-\u0026gt;value(); } public function value(): int { return $this-\u0026gt;value; } } Istnieje jeszcze trzecia metoda, o ktÃ³rej dobry programista nigdy nie powinien pomyÅ›leÄ‡. Tam gdzie chcesz porÃ³wnaÄ‡ Value Objectâ€™y, po prostu porÃ³wnaj ich wartoÅ›ci ifâ€™em w kaÅ¼dym miejscu gdzie tego potrzebujesz. Chyba nie muszÄ™ mÃ³wiÄ‡ jak to wyglÄ…da i czym siÄ™ ostatecznie zakoÅ„czy? ğŸ™‚\nKoncept Whole Value Pattern Tak jak wspomniaÅ‚em we wczeÅ›niejszym akapicie, obiekty wartoÅ›ci muszÄ… byÄ‡ zawsze w poprawnym stanie. StÄ…d wartoÅ›ci powinny speÅ‚niaÄ‡ koncept Whole Value Pattern zdefiniowany przez Wardâ€™a Cunninghamâ€™a w The checks Pattern Language of Information Integrity w 1994 roku. Aby zapewniÄ‡ poprawny stan obiektu, podczas jego tworzenia naleÅ¼y sprawdzaÄ‡ wprowadzane wartoÅ›ci. Sprawdzanie to powinno odbywaÄ‡ siÄ™ wewnÄ…trz Value Objectâ€™u. Dlaczego robimy to wewnÄ…trz obiektu? WyobraÅ¼my sobie sytuacjÄ™, Å¼e nasz obiekt zawiera siÄ™ w jakimÅ› innym obiekcie, na przykÅ‚ad Encji. Zgodzisz siÄ™ ze mnÄ…, Å¼e walidowanie czy Value Object posiada poprawny stan nie jest odpowiedzialnoÅ›ciÄ… Encji lub innej klasy. Narusza to przecieÅ¼ zasadÄ™ jednej odpowiedzialnoÅ›ci (ang. Single Responibility Principle).\nTo Value Object or not to Value Object Mam nadziejÄ™, Å¼e po przeczytaniu artykuÅ‚u rÃ³wnieÅ¼ tak jak ja, uwaÅ¼asz, Å¼e obiekty wartoÅ›ci sÄ… bardzo przydatne w modelowaniu Domeny. RozwiÄ…zujÄ… one wiele problemÃ³w, przy czym sÄ… bardzo Å‚atwe w implementacji oraz utrzymaniu. Dodatkowo w Å›ciÅ›le okreÅ›lonym kontekÅ›cie kaÅ¼dy ekspert domenowy oraz programista dokÅ‚adnie wie co oznacza przedstawiana wartoÅ›Ä‡ i jakie mamy wobec nich oczekiwania.\nDaj znaÄ‡ w komentarzach co sÄ…dzisz o Value Objectâ€™ach. JeÅ¼eli masz jakieÅ› ciekawe doÅ›wiadczenia z obiektami wartoÅ›ci, z chÄ™ciÄ… wymieniÄ™ siÄ™ doÅ›wiadczeniem w komentarzach.\n","permalink":"https://g-stawarczyk.github.io/2020/09/value-object-podstawowy-element-domain-driven-design/","summary":"Podczas programowania obiektowego bardzo czÄ™sto wykorzystujemy typy primitywne do przedstawienia jakiejÅ› wartoÅ›ci. Przy tym bardzo czÄ™sto musimy zmierzyÄ‡ siÄ™ z przekazywaniem oraz modyfikacjÄ… tych wartoÅ›ci. IdÄ…c dalej, chcemy mieÄ‡ przecieÅ¼ poprawne dane, wiÄ™c sprawdzamy ich poprawnoÅ›Ä‡ dodajÄ…c dodatkowÄ… logikÄ™ walidujÄ…cÄ…. A co w sytuacji, gdy danÄ… wartoÅ›Ä‡, ktÃ³ra reprezentuje jakiÅ› koncept, chcemy wykorzystaÄ‡ w wiÄ™cej niÅ¼ jednym miejscu? Duplikujemy logikÄ™ sprawdzania ich poprawnoÅ›ci? Wybieramy specjalne miejsce aby utworzyÄ‡ klasÄ™ walidacji, a moÅ¼e duplikujemy kod?","title":"Value Object â€“ Podstawowy element Domain Driven Design"},{"content":"CzeÅ›Ä‡. JeÅ¼eli tutaj trafiÅ‚eÅ›, to znaczy, Å¼e szukasz informacji na temat DDD â€“ Domain Driven Design. ChciaÅ‚bym CiÄ™ zaprosiÄ‡ do serii artykuÅ‚Ã³w poÅ›wiÄ™conych metodologii DDD. Postaram siÄ™ Tobie w zrozumiaÅ‚y sposÃ³b przybliÅ¼yÄ‡ czym jest DDD oraz kiedy warto stosowaÄ‡ to podejÅ›cie.\nW trakcie caÅ‚ej serii pojawiÄ… siÄ™ przykÅ‚ady w jÄ™zyku PHP, ktÃ³re dopeÅ‚niÄ… caÅ‚oÅ›Ä‡, a Tobie czytelniku, dostarczÄ… praktycznej wiedzy w zakresie wykorzystania Domain Driven Design.\nDDD â€“ co to takiego? Domain Driven Design jest to koncept sÅ‚uÅ¼Ä…cy do projektowania systemÃ³w, ktÃ³ry polega na tym, aby oprogramowanie jak najbardziej odzwierciedlaÅ‚o rzeczywisty system lub proces. Kod, ktÃ³ry napiszemy, powinien byÄ‡ odzwierciedleniem biznesu, a wszechobecny jÄ™zyk (ang. ubiquitous language) uÅ¼yty w projekcie powinien byÄ‡ spÃ³jny i zrozumiaÅ‚y z â€biznesemâ€.\nInnymi sÅ‚owy, DDD to zestaw narzÄ™dzi, struktur oraz terminologii, ktÃ³rych uÅ¼ywamy podczas projektowania i implementacji modeli biznesowych. JednÄ… z najwaÅ¼niejszych zaÅ‚oÅ¼eÅ„ konceptu DDD jest gÅ‚Ä™bokie nastawienie na wspÃ³Å‚pracÄ™ miÄ™dzy osobami z â€biznesuâ€, a zespoÅ‚em technicznym odpowiedzialnym za aplikacjÄ™.\nKim sÄ… â€osoby z biznesuâ€? SÄ… to osoby, czÄ™sto nietechniczne, ktÃ³re majÄ… bardzo duÅ¼Ä… wiedzÄ™ na temat dziedziny biznesu klienta i procesÃ³w jakie tam zachodzÄ…, a jakie aplikacja ma rozwiÄ…zaÄ‡. Takie osoby zwane sÄ… ekspertami domenowymi. Nie martwcie siÄ™, nie sÄ… to osoby, ktÃ³re tworzÄ… oprogramowanie. Eksperci domenowi pomagajÄ… zrozumieÄ‡ architektom i programistom dziedzinÄ™, wspierajÄ…c ich wiedzÄ… biznesowÄ….\nDomena W najprostszych sÅ‚owach, domena to obszar biznesu, z ktÃ³rym pracujesz i problemy jakie musi rozwiÄ…zaÄ‡. Model, ktÃ³ry zostanie zaprojektowany jest rozwiÄ…zaniem problemu biznesowego. Domena nie skupia siÄ™ na technicznych aspektach takich jak na przykÅ‚ad framework, czy baza danych. JeÅ¼eli Twoim zadaniem jest zaprojektowanie aplikacji z ogÅ‚oszeniami, DomenÄ… Twojej aplikacji bÄ™dzie wszystko co jest zwiÄ…zane bezpoÅ›rednio z ogÅ‚oszeniami i ma byÄ‡ zaimplementowane w aplikacji (np. reguÅ‚y biznesowe, czy problemy).\nJednÄ… z najwaÅ¼niejszych rzeczy w DDD jest wyznaczenie jÄ™zyka wszechobecnego (ang. Ubiquitous language), ktÃ³rym bÄ™dzie podÄ…Å¼aÅ‚ model Domenowy.\nWszechobecny jÄ™zyk Ubiquitous language to definicja zrozumiaÅ‚ego jÄ™zyka dla ekspertÃ³w domenowych oraz programistÃ³w implementujÄ…cych zaprojektowany system. Zdefiniowany jÄ™zyk musi mieÄ‡ swoje odzwierciedlenie w Domenie aplikacji. Wyznaczenie wspÃ³lnego, uniwersalnego jÄ™zyka jest kluczem do rozwiÄ…zania niejasnoÅ›ci, niezrozumienia i barier w komunikacji pomiÄ™dzy zespoÅ‚em programistycznym a biznesem.\nWszechobecny jÄ™zyk rozwija siÄ™ wraz z rosnÄ…cym biznesem.\nDomain experts should object to terms or structures that are awkward or inadequate to convey domain understanding; developers should watch for ambiguity or inconsistency that will trip up design.\n\u0026ndash; Eric Evan\nMam nadziejÄ™, Å¼e wyjaÅ›niÅ‚em Ci w zrozumiaÅ‚y sposÃ³b czym jest Domain Driven Design. W kolejnych artykuÅ‚ach zagÅ‚Ä™bimy siÄ™ w koncept DDD, w ktÃ³rym poznamy nieco przykÅ‚adÃ³w ze Å›wiata DDD.\n","permalink":"https://g-stawarczyk.github.io/2020/07/ddd-domain-driven-design/","summary":"CzeÅ›Ä‡. JeÅ¼eli tutaj trafiÅ‚eÅ›, to znaczy, Å¼e szukasz informacji na temat DDD â€“ Domain Driven Design. ChciaÅ‚bym CiÄ™ zaprosiÄ‡ do serii artykuÅ‚Ã³w poÅ›wiÄ™conych metodologii DDD. Postaram siÄ™ Tobie w zrozumiaÅ‚y sposÃ³b przybliÅ¼yÄ‡ czym jest DDD oraz kiedy warto stosowaÄ‡ to podejÅ›cie.\nW trakcie caÅ‚ej serii pojawiÄ… siÄ™ przykÅ‚ady w jÄ™zyku PHP, ktÃ³re dopeÅ‚niÄ… caÅ‚oÅ›Ä‡, a Tobie czytelniku, dostarczÄ… praktycznej wiedzy w zakresie wykorzystania Domain Driven Design.\nDDD â€“ co to takiego?","title":"DDD â€“ Domain Driven Design"},{"content":"CzeÅ›Ä‡. W dzisiejszym wpisie sprawdzimy jak dziaÅ‚a najnowsza wersja menadÅ¼era zaleÅ¼noÅ›ci composer w wersji 2.0.0-alpha1. PorÃ³wnamy jak wyglÄ…da dziaÅ‚anie, czas wykonywania zadania oraz zuÅ¼ycie pamiÄ™ci RAM podczas operacji instalowania, aktualizowania oraz dodawania nowej biblioteki.\nProjekt, na ktÃ³rym bÄ™dziemy testowaÄ‡ menadÅ¼era zbudowany jest z wykorzystaniem Symfony 4.2 i wymaga 36 bibliotek â€“ tyle pozycji wpisanych jest w pliku composer.json. Po uwzglÄ™dnieniu zaleÅ¼noÅ›ci wszystkich bibliotek mamy 128 paczek.\nSzybsze pobieranie Najbardziej wyczekiwanÄ… i zarazem najbardziej zauwaÅ¼alnÄ… zmianÄ… w drugiej wersji composera jest zmieniony workflow instalowania, dodawania, aktualizacji czy usuwania paczek, co ma znaczÄ…cy wpÅ‚yw na wydajnoÅ›Ä‡. W wersji 1.x menadÅ¼er pobiera i instaluje paczka po paczce, a w wersji 2.x menadÅ¼er najpierw pobiera paczki oraz ich meta dane a nastÄ™pnie po zakoÅ„czeniu Å›ciÄ…gania instaluje je. Wszystko to dzieje siÄ™ rÃ³wnolegle. DziÄ™ki takiemu zabiegowi caÅ‚oÅ›Ä‡ dziaÅ‚a o wiele szybciej. Zobaczmy poniÅ¼sze logi, jak wyglÄ…daÅ‚a proces instalowania:\ncomposer 1.10.7\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 www-data@grzegorz-php74:~/project$ composer install --no-cache --no-scripts --profile [9.2MiB/0.02s] Loading composer repositories with package information [9.6MiB/0.02s] Installing dependencies (including require-dev) from lock file [10.5MiB/0.05s] Package operations: 128 installs, 0 updates, 0 removals [10.5MiB/0.05s] - Installing ocramius/package-versions (1.8.0): [10.6MiB/0.05s] [10.6MiB/0.72s] Downloading (0%) [10.6MiB/0.72s] Downloading (5%) [10.6MiB/0.72s] Downloading (10%) ... [11.9MiB/59.44s] - Installing symfony/profiler-pack (v1.0.4): [11.9MiB/59.44s] [11.9MiB/59.73s] Downloading (100%)[11.9MiB/59.73s] [11.2MiB/60.07s] Package zendframework/zend-eventmanager is abandoned, you should avoid using it. Use laminas/laminas-eventmanager instead. [11.2MiB/60.07s] Package zendframework/zend-code is abandoned, you should avoid using it. Use laminas/laminas-code instead. [11.2MiB/60.07s] Package symfony/lts is abandoned, you should avoid using it. Use symfony/flex instead. [11.2MiB/60.07s] Package phpunit/phpunit-mock-objects is abandoned, you should avoid using it. No replacement was suggested. [11.2MiB/60.07s] Generating autoload files [11.5MiB/60.12s] 5 packages you are using are looking for funding. [11.5MiB/60.12s] Use the `composer fund` command to find out more! [11.4MiB/60.12s] Memory usage: 11.41MiB (peak: 12.86MiB), time: 60.12s composer 2.0-alpha1\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 www-data@grzegorz-php74:~/project$ composer install --no-cache --no-scripts --profile [8.9MiB/0.01s] Installing dependencies from lock file (including require-dev) [9.9MiB/0.02s] Verifying lock file contents can be installed on current platform. [11.5MiB/0.05s] Package operations: 128 installs, 0 updates, 0 removals [11.6MiB/0.05s] - Downloading ocramius/package-versions (1.8.0) ... [14.3MiB/0.10s] - Downloading symfony/validator (v4.2.8) [13.6MiB/12.92s] - Installing ocramius/package-versions (1.8.0): Extracting archive ... [18.0MiB/17.99s] - Installing symfony/validator (v4.2.8): Extracting archive [16.3MiB/22.92s] Package symfony/lts is abandoned, you should avoid using it. Use symfony/flex instead. [16.3MiB/22.92s] Package symfony/lts is abandoned, you should avoid using it. Use symfony/flex instead. [16.3MiB/22.92s] Package zendframework/zend-code is abandoned, you should avoid using it. Use laminas/laminas-code instead. [16.3MiB/22.92s] Package zendframework/zend-eventmanager is abandoned, you should avoid using it. Use laminas/laminas-eventmanager instead. [16.3MiB/22.92s] Package phpunit/phpunit-mock-objects is abandoned, you should avoid using it. No replacement was suggested. [16.3MiB/22.92s] Generating autoload files [16.7MiB/22.98s] 5 packages you are using are looking for funding. [16.7MiB/22.98s] Use the `composer fund` command to find out more! [16.7MiB/22.99s] Memory usage: 16.68MiB (peak: 18.89MiB), time: 22.99s Test composer install PrzejdÅºmy zatem do pierwszego testu â€“ composer install. Testy przeprowadziÅ‚em w kontenerze docker z PHP7.4 i synchronizacjÄ… mutagen przy uÅ¼yciu pamiÄ™ci podrÄ™cznej oraz bez niej. KaÅ¼dy test wykonany zostaÅ‚ piÄ™ciokrotnie, a wyniki zostaÅ‚y uÅ›rednione. PoniÅ¼ej moÅ¼emy zobaczyÄ‡ wykres porÃ³wnujÄ…cy czasy instalacji bibliotek testowego projektu z wykorzystaniem composera w wersji 1.10.7 oraz 2.0-alpha1.\nO ile czas z wykorzystaniem cache nie robi wraÅ¼enia, o tyle instalacja bez wykorzystania pamiÄ™ci podrÄ™cznej juÅ¼ tak. Mamy tutaj prawie trzy krotne zmniejszenie czasu caÅ‚ej operacji! Jest teÅ¼ maÅ‚a uwaga, zuÅ¼ycie pamiÄ™ci wzrosÅ‚o o okoÅ‚o 35%, ale jest to nadal maÅ‚e zapotrzebowanie pamiÄ™ci.\nTest composer update oraz composer require Czas na aktualizacje biblioteki. W tej operacji, composer musi sprawdziÄ‡ caÅ‚e drzewo zaleÅ¼noÅ›ci, co w wersji pierwszej narzÄ™dzia zajmuje bardzo duÅ¼o czasu oraz pamiÄ™ci. Biblioteka jest w najnowszej wersji, wiÄ™c sprawdzony zostaÅ‚ jedynie czas przygotowania do pobierania. Samo Å›ciÄ…ganie paczek odbywa siÄ™ wedÅ‚ug flow opisanego w composer install.\nSprawdziÅ‚em rÃ³wnieÅ¼ jak wyglÄ…da proces dodawania nowej biblioteki do projektu.\nTak jak w pierwszym teÅ›cie, kaÅ¼dy przypadek sprawdziÅ‚em 5 razy, a wyniki zostaÅ‚y uÅ›rednione.\nWydajnoÅ›Ä‡ drugiej wersji menadÅ¼era zaleÅ¼noÅ›ci robi na prawdÄ™ duÅ¼e wraÅ¼enie. Czasy zmniejszyÅ‚y siÄ™ kilkukrotnie, a zuÅ¼ycie pamiÄ™ci â€“ no cÃ³Å¼, wykres mÃ³wi wszystko.\nUruchomienie jako root wymaga potwierdzenia Od wersji 2.0 composer wymaga potwierdzenia, jeÅ¼eli zostanie uruchomiony z konta roota. Jako, Å¼e biblioteka moÅ¼e za pomocÄ… composera wykonaÄ‡ dowolny kod na maszynie uÅ¼ytkownika, jest to dobry krok w stronÄ™ bezpieczeÅ„stwa.\nDry-run KolejnÄ… nowoÅ›ciÄ… jest opcja â€“dry-run dla operacji usuwania (remove) oraz dodawania (require). Czy bÄ™dzie mocno uÅ¼ywana? Nie wiem, ale gdyby ktoÅ› chciaÅ‚ to jest ğŸ˜€\nNowy format metadanych repozytoriÃ³w Wraz z wydaniem wersji drugiej menadÅ¼era, dodany zostaÅ‚ nowy format metadanych repozytoriÃ³w. Pierwsza wersja menadÅ¼era zaleÅ¼noÅ›ci pobieraÅ‚a ogromy plik JSON. Najnowszy format to zestaw maÅ‚ych plikÃ³w JSON, ktÃ³re composer moÅ¼e pobraÄ‡ i zapisaÄ‡ w cache.\nAby sprawdziÄ‡, czy dane repozytorium wspiera nowy format, wystarczy, Å¼e poszukamy klucza metadata-url w pliku packages.json. Gdy tylko omawiany format jest dostÄ™pny, composer 2 bÄ™dzie korzystaÅ‚ z nowych danych, a wersja pierwsza nadal bÄ™dzie korzystaÄ‡ tylko ze starego formatu.\nNajpopularniejsze repozytorium paczek Packagist.org wspiera juÅ¼ nowy format.\n","permalink":"https://g-stawarczyk.github.io/2020/06/composer-2.0-sprawd%C5%BAmy-jak-dzia%C5%82a-nowy-menad%C5%BCer-paczek/","summary":"CzeÅ›Ä‡. W dzisiejszym wpisie sprawdzimy jak dziaÅ‚a najnowsza wersja menadÅ¼era zaleÅ¼noÅ›ci composer w wersji 2.0.0-alpha1. PorÃ³wnamy jak wyglÄ…da dziaÅ‚anie, czas wykonywania zadania oraz zuÅ¼ycie pamiÄ™ci RAM podczas operacji instalowania, aktualizowania oraz dodawania nowej biblioteki.\nProjekt, na ktÃ³rym bÄ™dziemy testowaÄ‡ menadÅ¼era zbudowany jest z wykorzystaniem Symfony 4.2 i wymaga 36 bibliotek â€“ tyle pozycji wpisanych jest w pliku composer.json. Po uwzglÄ™dnieniu zaleÅ¼noÅ›ci wszystkich bibliotek mamy 128 paczek.\nSzybsze pobieranie Najbardziej wyczekiwanÄ… i zarazem najbardziej zauwaÅ¼alnÄ… zmianÄ… w drugiej wersji composera jest zmieniony workflow instalowania, dodawania, aktualizacji czy usuwania paczek, co ma znaczÄ…cy wpÅ‚yw na wydajnoÅ›Ä‡.","title":"Composer 2.0 â€“ sprawdÅºmy jak dziaÅ‚a nowy menadÅ¼er paczek"},{"content":"Dzisiaj, krÃ³tki wpis na temat powtarzania treÅ›ci w docker-compose.\nCzy wiesz, Å¼e zasadÄ™ DRY moÅ¼na zastosowaÄ‡ rÃ³wnieÅ¼ w pliku docker-compose? Nie jest to jednak mechanizm samego dockera a jÄ™zyka YAML. Mowa tutaj o funkcjach anchor oraz merge.\nJak to wyglÄ…da w praktyce? WyobraÅºmy sobie, Å¼e nasze Å›rodowisko lokalne nie jest unikalne dla kaÅ¼dego projektu, a po prostu mamy 1 plik docker-compose, ktÃ³ry uruchamia nam serwer http, bazÄ™ danych i kilka wersji PHP. Projekty muszÄ… siÄ™ komunikowaÄ‡ ze sobÄ…, a wszystkie logi zapisujemy do grayloga. Jak moÅ¼e wyglÄ…daÄ‡ wtedy plik docker-compose?\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 version: \u0026#39;3.7\u0026#39; services: mysql: hostname: mysql image: mysql:5.7 volumes: - mysql_volume:/var/lib/mysql ports: - 3306:3306 environment: - MYSQL_ROOT_PASSWORD=docker - MYSQL_DATABASE=db - MYSQL_USER=user - MYSQL_PASSWORD=password networks: mynet: logging: driver: gelf options: gelf-address: \u0026#34;udp://1.2.3.4:12201\u0026#34; nginx: hostname: nginx build: context: docker/nginx args: - WWW_DATA_UID=${WWW_DATA_UID} ports: - 8080:80 volumes: - ~/.composer:/var/www/.composer:delegated - ../project_one:/var/www/app/project_one - ../project_two:/var/www/app/project_two networks: mynet: ipv4_address: 172.26.0.6 logging: driver: gelf options: gelf-address: \u0026#34;udp://1.2.3.4:12201\u0026#34; php73: hostname: php73 build: context: docker/php/php73-fpm args: - WWW_DATA_UID=${WWW_DATA_UID} volumes: - ~/.composer:/var/www/.composer:delegated - ../project_one:/var/www/app/project_one - ../project_two:/var/www/app/project_two extra_hosts: - \u0026#34;project-one.local:172.26.0.6\u0026#34; - \u0026#34;project-two.local:172.26.0.6\u0026#34; networks: mynet: logging: driver: gelf options: gelf-address: \u0026#34;udp://1.2.3.4:12201\u0026#34; php74: hostname: php74 build: context: docker/php/php74-fpm args: - WWW_DATA_UID=${WWW_DATA_UID} volumes: - ~/.composer:/var/www/.composer:delegated - ../project_one:/var/www/app/project_one - ../project_two:/var/www/app/project_two extra_hosts: - \u0026#34;project-one.local:172.26.0.6\u0026#34; - \u0026#34;project-two.local:172.26.0.6\u0026#34; networks: mynet: logging: driver: gelf options: gelf-address: \u0026#34;udp://1.2.3.4:12201\u0026#34; networks: mynet: driver: bridge ipam: config: - subnet: 172.26.0.0/24 volumes: mysql_volume: Sporo powtÃ³rzeÅ„ prawda? 4 kontenery, a prawie 90 linii kodu. Jednak duÅ¼a objÄ™toÅ›Ä‡ to nie wszystkie minusy. W sytuacji, kiedy bÄ™dziemy chcieli dodaÄ‡ kolejny projekt, musimy zrobiÄ‡ zmianÄ™ w wolumenach oraz hostach. Musimy wiÄ™c edytowaÄ‡ volume w trzech kontenerach i extra_hosts w dwÃ³ch.\nAnchor i Merge Z pomocÄ… przychodzÄ… nam funkcjÄ™ anchor oraz merge. Jak one dziaÅ‚ajÄ…? Zobaczmy to na poniÅ¼szych przykÅ‚adach. Lewa kolumna to zapis skrÃ³cony, a prawa to wynik co widzi parser:\n1 2 3 4 5 anchor: \u0026amp;app key_one: 1 key_two: value merge: *app 1 2 3 4 5 6 7 anchor: key_one: 1 key_two: value merge: key_one: 1 key_two: value Oba klucze bÄ™dÄ… miaÅ‚y takÄ… samÄ… treÅ›Ä‡ â€“ key_one oraz key_two. MoÅ¼emy Å‚Ä…czyÄ‡ wiÄ™cej niÅ¼ 1 element w caÅ‚oÅ›Ä‡:\n1 2 3 4 5 6 7 8 anchor_one: \u0026amp;app key_one: 1 anchor_two: \u0026amp;app2 key_two: value merge: \u0026lt;\u0026lt;: [*app, *app2] 1 2 3 4 5 6 7 8 9 anchor_one: key_one: 1 anchor_two: key_two: value merge: key_one: 1 key_two: value MoÅ¼emy rÃ³wnieÅ¼ nadpisywaÄ‡ wartoÅ›ci z kotwic\n1 2 3 4 5 6 7 anchor: \u0026amp;app key_one: 1 key_two: value merge: \u0026lt;\u0026lt;: *app key_two: value2 1 2 3 4 5 6 7 anchor: key_one: 1 key_two: value merge: key_one: 1 key_two: value2 PoÅ‚Ä…czmy wszystko w caÅ‚oÅ›Ä‡ Skoro teoriÄ™ mamy juÅ¼ za sobÄ…, to sprawdÅºmy jak moÅ¼emy zmieniÄ‡ przykÅ‚adowy docker-compose, aby nie zawieraÅ‚ zbÄ™dnych powtÃ³rzeÅ„. Z powtarzajÄ…cych siÄ™ elementÃ³w mamy: volume, network, logging oraz extra_hosts.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 version: \u0026#39;3.7\u0026#39; x-default_hosts: \u0026amp;hosts extra_hosts: - \u0026#34;project-one.local:172.26.0.6\u0026#34; - \u0026#34;project-two.local:172.26.0.6\u0026#34; x-default_service: \u0026amp;default_service networks: mynet: logging: driver: gelf options: gelf-address: \u0026#34;udp://1.2.3.4:12201\u0026#34; x-default_volumes: \u0026amp;appvolumes volumes: - ~/.composer:/var/www/.composer:delegated - ../project_one:/var/www/app/project_one - ../project_two:/var/www/app/project_two services: mysql: \u0026lt;\u0026lt;: *default_service hostname: mysql image: mysql:5.7 volumes: - mysql_volume:/var/lib/mysql ports: - 3306:3306 environment: - MYSQL_ROOT_PASSWORD=docker - MYSQL_DATABASE=db - MYSQL_USER=user - MYSQL_PASSWORD=password nginx: \u0026lt;\u0026lt;: [*default_service, *appvolumes] hostname: nginx build: context: docker/nginx args: - WWW_DATA_UID=${WWW_DATA_UID} ports: - 8080:80 networks: mynet: ipv4_address: 172.26.0.6 php73: \u0026lt;\u0026lt;: [*default_service, *appvolumes, *hosts] hostname: php73 build: context: docker/php/php73-fpm args: - WWW_DATA_UID=${WWW_DATA_UID} php74: \u0026lt;\u0026lt;: [*default_service, *appvolumes, *hosts] hostname: php74 build: context: docker/php/php74-fpm args: - WWW_DATA_UID=${WWW_DATA_UID} networks: mynet: driver: bridge ipam: config: - subnet: 172.26.0.0/24 volumes: mysql_volume: Z 88 linii zmniejszyliÅ›my kod do 71, ale nie to jest najwaÅ¼niejsze. ZyskaliÅ›my czytelnoÅ›Ä‡ i Å‚atwoÅ›Ä‡ zmian poszczegÃ³lnych fragmentÃ³w kodu.\nKod, ktÃ³ry tutaj opisaÅ‚em jest moÅ¼liwy do osiÄ…gniÄ™cia od wersji pliku 3.4. JeÅ¼eli uÅ¼ywasz niÅ¼szej wersji, moÅ¼esz rÃ³wnieÅ¼ uÅ¼yÄ‡ anchor oraz merge, jednak nie moÅ¼esz zdefiniowaÄ‡ wÅ‚asnych obiektÃ³w, poniewaÅ¼ docker-compose na to nie pozwala. MoÅ¼esz to obejÅ›Ä‡ stosujÄ…c kotwice w definicji serwisu i wykorzystaÄ‡ jÄ… w kolejnym:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 version: \u0026#39;3.7\u0026#39; services: mysql: hostname: mysql image: mysql:5.7 volumes: - mysql_volume:/var/lib/mysql ports: - 3306:3306 environment: - MYSQL_ROOT_PASSWORD=docker - MYSQL_DATABASE=db - MYSQL_USER=user - MYSQL_PASSWORD=password networks: \u0026amp;appnetwork mynet: logging: \u0026amp;applogging driver: gelf options: gelf-address: \u0026#34;udp://1.2.3.4:12201\u0026#34; nginx: hostname: nginx build: context: docker/nginx args: - WWW_DATA_UID=${WWW_DATA_UID} ports: - 8080:80 logging: *applogging volumes: \u0026amp;appvolumes - ~/.composer:/var/www/.composer:delegated - ../project_one:/var/www/app/project_one - ../project_two:/var/www/app/project_two networks: mynet: ipv4_address: 172.26.0.6 php73: hostname: php73 build: context: docker/php/php73-fpm args: - WWW_DATA_UID=${WWW_DATA_UID} volumes: *appvolumes logging: *applogging networks: *appnetwork extra_hosts: \u0026amp;apphosts - \u0026#34;project-one.local:172.26.0.6\u0026#34; - \u0026#34;project-two.local:172.26.0.6\u0026#34; php74: hostname: php74 build: context: docker/php/php74-fpm args: - WWW_DATA_UID=${WWW_DATA_UID} volumes: *appvolumes logging: *applogging networks: *appnetwork extra_hosts: *apphosts networks: mynet: driver: bridge ipam: config: - subnet: 172.26.0.0/24 volumes: mysql_volume: Kodu jest trochÄ™ mniej, ale wedÅ‚ug mnie ucierpiaÅ‚a tutaj czytelnoÅ›Ä‡ i Å‚atwoÅ›Ä‡ dodania nowych funkcji do wszystkich kontenerÃ³w na raz.\nDaj znaÄ‡ w komentarzu, czy podobaÅ‚ Ci siÄ™ artykuÅ‚. Daj to niesamowitej energii do pisania kolejnych treÅ›ci. SprawdÅº rÃ³wnieÅ¼ mÃ³j wczeÅ›niejszy artykuÅ‚ na temat optymalizacji docker for mac.\n","permalink":"https://g-stawarczyk.github.io/2020/06/docker-compose-dont-repeat-yourself/","summary":"Dzisiaj, krÃ³tki wpis na temat powtarzania treÅ›ci w docker-compose.\nCzy wiesz, Å¼e zasadÄ™ DRY moÅ¼na zastosowaÄ‡ rÃ³wnieÅ¼ w pliku docker-compose? Nie jest to jednak mechanizm samego dockera a jÄ™zyka YAML. Mowa tutaj o funkcjach anchor oraz merge.\nJak to wyglÄ…da w praktyce? WyobraÅºmy sobie, Å¼e nasze Å›rodowisko lokalne nie jest unikalne dla kaÅ¼dego projektu, a po prostu mamy 1 plik docker-compose, ktÃ³ry uruchamia nam serwer http, bazÄ™ danych i kilka wersji PHP.","title":"Docker Compose â€“ Donâ€™t repeat yourself"},{"content":"JeÅ›li rÃ³wnieÅ¼ pracujesz na Macu i masz problem z wolno dziaÅ‚ajÄ…cym Docker for Mac, to mam dla Ciebie kilka trickÃ³w, ktÃ³re przyspieszÄ… dziaÅ‚anie Twojego Dockera bez dodatkowych narzÄ™dzi.\nAle na poczÄ…tek, jak wyglÄ…dajÄ… czasy jednego z projektÃ³w nad ktÃ³rym pracuje. Zobaczmy wiÄ™c docker-compose. MoÅ¼emy w nim zauwaÅ¼yÄ‡ montowanie wolumenu do kontenera nginx i nadanie mu aliasu, ktÃ³ry wykorzystujemy w kontenerze PHP.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 version: \u0026#39;2\u0026#39; services: nginx: hostname: nginx build: context: docker/nginx ports: - 8080:80 volumes: \u0026amp;appvolumes - ../:/var/www/app networks: mynet: ipv4_address: 172.26.0.1 php74: hostname: php74 build: context: docker/php/php74-fpm volumes: *appvolumes networks: mynet: ipv4_address: 172.26.0.2 Jak sami widzicie, czasy sÄ… nie do zaakceptowania. A jest to tylko jedna prosta podstrona aplikacji z wykorzystaniem Symfony.\nCo moÅ¼emy w takiej sytuacji zrobiÄ‡? SprawdÅºmy jak bÄ™dÄ… wyglÄ…daÅ‚y czasy po wprowadzeniu kilku poprawek wydajnoÅ›ciowych.\n1. UÅ¼ywaj NFS Po pierwsze wykorzystaj NFS do synchronizacji danych miÄ™dzy hostem lokalnym a kontenerem. Przyspieszy to dziaÅ‚anie dockera.\nPobieramy plik z gist â€“ https://gist.github.com/seanhandley/7dad300420e5f8f02e7243b7651c6657#file-setup_native_nfs_docker_osx-sh Uruchamiamy pobrany wczeÅ›niej skrypt Modyfikujemy docker-compose 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 version: \u0026#39;2\u0026#39; volumes: nfsmount: driver: local driver_opts: type: nfs o: addr=host.docker.internal,rw,nolock,hard,nointr,nfsvers=3 device: \u0026#34;/absolute/path/to/project/dir\u0026#34; services: nginx: hostname: nginx build: context: docker/nginx ports: - 8080:80 volumes: \u0026amp;appvolumes - nfsmount:/var/www/app ... Uruchamiamy kontener Jak to wyglÄ…da teraz dla tej samej strony? Na pewno duÅ¼e lepiej, ale nadal nie jest idealnie.\nPierwsze zaÅ‚adowanie po zmianach w kodzie\nKolejne zaÅ‚adowanie strony\n2. WyrzuÄ‡ niepotrzebne sprawdzanie katalogÃ³w Docker for Mac domyÅ›lnie ma ustawione kilka gÅ‚Ã³wnych katalogÃ³w, ktÃ³re za kaÅ¼dym razem sprawdza czy, ktÃ³ryÅ› plik siÄ™ nie zmieniÅ‚. JeÅ¼eli uÅ¼ywamy NFSâ€™a jest to zbÄ™dna operacja, ktÃ³ra tylko zajmuje czas. Nie potrzebujemy, aby docker zajmowaÅ‚ siÄ™ sprawdzaniem i synchronizacjÄ… plikÃ³w miÄ™dzy hostem a kontenerem, poniewaÅ¼ mamy od tego NFS.\nWchodzimy wiÄ™c w ustawienia Docker for Mac \u0026gt; Resources \u0026gt; File sharing, a nastÄ™pnie usuwamy wszystkie pozycje. JeÅ¼eli jednak potrzebujecie synchronizowaÄ‡ jakiÅ› katalog bez uÅ¼ycia NFS, wybierzcie jego Å›cieÅ¼kÄ™. DziÄ™ki temu nadal bÄ™dziecie mogli wykorzystywaÄ‡ synchronizacjÄ™ plikÃ³w, ktÃ³ra zapewnia Docker, a jednoczeÅ›nie przyspieszycie aplikacjÄ™.\nUwaga, wykorzystanie tego kroku, praktycznie eliminuje uÅ¼ywanie docker run, a co za tym idzie, rÃ³wnieÅ¼ nie skorzystamy w dockera w naszym IDE. Wszystko bÄ™dziemy musieli uruchamiaÄ‡ w dziaÅ‚ajÄ…cym kontenerze via CLI.\nSprawdÅºmy jak teraz dziaÅ‚a nasza aplikacja.\nPierwsze zaÅ‚adowanie po zmianach\nKolejne zaÅ‚adowanie strony\nNa prostej stronie nie widzimy zbyt duÅ¼ej rÃ³Å¼nicy. Jednak przy wiÄ™kszych projektach, ta rÃ³Å¼nica potrafi byÄ‡ spora.\n3. Wersja Edge â€“ mutagen.io Najnowsza wersja Docker for Mac w wersji Edge wprowadziÅ‚a moÅ¼liwoÅ›Ä‡ synchronizacji plikÃ³w przy pomocy mutagen.io. WiÄ™cej informacji znajdziesz tutaj: klik. WedÅ‚ug mnie bÄ™dzie to game changer dla osÃ³b pracujÄ…cych na Macu. Dlaczego bÄ™dzie skoro zostaÅ‚o juÅ¼ wprowadzone? Po pierwsze jest to dopiero w wersji Edge, a po drugie ma jeszcze sporo bÅ‚Ä™dÃ³w i widaÄ‡ jedynie Error na liÅ›cie File Sharing. BÅ‚Ä™dy, ktÃ³re wystÄ…piÅ‚y moÅ¼emy zobaczyÄ‡ odpytujÄ…c lokalne API Dockera:\n1 curl -X GET --unix-socket ~/Library/Containers/com.docker.docker/Data/docker-api.sock http://localhost/cache/state | jq Implementacja mutagena a Dockerze ma problem z linkami absolutnymi w aplikacji. To niestety wyklucza uÅ¼ycie phpunit w symfony:\n1 2 3 4 5 6 7 8 9 { \u0026#34;/Users/grzegorz/dev/project\u0026#34;: { \u0026#34;status\u0026#34;: \u0026#34;Error\u0026#34;, \u0026#34;ready\u0026#34;: false, \u0026#34;problems\u0026#34;: [ \u0026#34;beta scan error: remote error: invalid symbolic link (project/vendor/bin/.phpunit/phpunit-5.7.27/vendor/symfony/phpunit-bridge): target is absolute\u0026#34; ] } } Mimo wszystko sprawdÅºmy jak zachowuje siÄ™ nasza aplikacja po wÅ‚Ä…czeniu mutagena.\n1 2 3 4 5 6 7 8 9 10 11 12 version: \u0026#39;2\u0026#39; services: nginx: hostname: nginx build: context: docker/nginx ports: - 8080:80 volumes: \u0026amp;appvolumes - ../:/var/www/app ... Pierwsze odÅ›wieÅ¼enie po zmianach w kodzie\nKolejne zaÅ‚adowanie\nWyglÄ…da to naprawÄ™ dobrze. Aleâ€¦ Dodajmy jeszcze volumen na cache\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 version: \u0026#39;2\u0026#39; volumes: app_cache: services: nginx: hostname: nginx build: context: docker/nginx ports: - 8080:80 volumes: \u0026amp;appvolumes - ../:/var/www/app - app_cache:/var/www/app/project/var/cache ... Pierwsze zaÅ‚adowanie po zmianach w kodzie\nKolejne odÅ›wieÅ¼enie strony\nPraca z dockerem na Mac OSX wcale nie musi byÄ‡ utrapieniem. JeÅ¼eli znasz jeszcze inne tricki jak zoptymalizowaÄ‡ dockera, koniecznie daj znaÄ‡ w komentarzu.\nP.S. JeÅ¼eli bÄ™dziesz chciaÅ‚ przejÅ›Ä‡ na Docker Edge, pamiÄ™taj, Å¼e pierwsze uruchomienie Docker Edge wyczyÅ›ci wszystkie obrazy, kontenery oraz wolumeny!! JeÅ¼eli masz kontenery z danymi, ktÃ³rych nie chciaÅ‚ byÅ› wyczyÅ›ciÄ‡, zrÃ³b koniecznie ich backup.\n","permalink":"https://g-stawarczyk.github.io/2020/06/docker-for-mac-3-sposoby-na-przyspieszenie-dzia%C5%82ania/","summary":"JeÅ›li rÃ³wnieÅ¼ pracujesz na Macu i masz problem z wolno dziaÅ‚ajÄ…cym Docker for Mac, to mam dla Ciebie kilka trickÃ³w, ktÃ³re przyspieszÄ… dziaÅ‚anie Twojego Dockera bez dodatkowych narzÄ™dzi.\nAle na poczÄ…tek, jak wyglÄ…dajÄ… czasy jednego z projektÃ³w nad ktÃ³rym pracuje. Zobaczmy wiÄ™c docker-compose. MoÅ¼emy w nim zauwaÅ¼yÄ‡ montowanie wolumenu do kontenera nginx i nadanie mu aliasu, ktÃ³ry wykorzystujemy w kontenerze PHP.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 version: \u0026#39;2\u0026#39; services: nginx: hostname: nginx build: context: docker/nginx ports: - 8080:80 volumes: \u0026amp;appvolumes - .","title":"Docker for Mac â€“ 3 sposoby na przyspieszenie dziaÅ‚ania"},{"content":"CzeÅ›Ä‡.\nW moim pierwszym wpisie, chciaÅ‚bym Wam przestawiÄ‡ wzorzec architektoniczny pipe \u0026amp; filters. Jest to sposÃ³b na rozbicie duÅ¼ego zadania na mniejsze czÄ™Å›ci w bardzo przejrzysty sposÃ³b. Zaletami takiego rozwiÄ…zania jest reuÅ¼ywalnoÅ›Ä‡ klas (filtrÃ³w), moÅ¼liwoÅ›Ä‡ szybkiej zmiany krokÃ³w wykonywania danego algorytmu oraz zrÃ³wnoleglenia procesu. NiewÄ…tpliwÄ… zaletÄ… jest rÃ³wnieÅ¼ testowalnoÅ›Ä‡. DziÄ™ki wyodrÄ™bnieniu poszczegÃ³lnych moduÅ‚Ã³w moÅ¼emy, kaÅ¼dy z krokÃ³w moÅ¼emy testowaÄ‡ w izolacji, na przykÅ‚ad testami jednostkowymi.\nJeÅ›li siÄ™ nie mylÄ™, historia tego rozwiÄ…zania siÄ™ga pamiÄ™ciÄ… do 1973 roku, kiedy to jeden z pomysÅ‚Ã³w Douglasa McIlroya zostaÅ‚ zaimplementowany w systemach UNIX. Douglas zauwaÅ¼yÅ‚, Å¼e dane wyjÅ›ciowe jednego programu mogÄ… stanowiÄ‡ dane wejÅ›ciowe do drugiego programu. W ten sposÃ³b powstaÅ‚y potoki, wywoÅ‚ania programÃ³w oddzielonych pionowÄ… liniÄ… â€|â€ (pipe). PrzykÅ‚ad wywoÅ‚ania potoku w systemach UNIX:\ntail -f /var/log/nginx/access.log | grep 500\nW architekturze aplikacyjnej, przykÅ‚adowym problemem do rozwiÄ…zania przez wzorzec pipe \u0026amp; filters moÅ¼e byÄ‡ obrÃ³bka pliku. ZaÅ‚Ã³Å¼my, Å¼e mamy spakowany plik CSV, z ktÃ³rego musimy wyciÄ…gnÄ…Ä‡ jakieÅ› dane, a nastÄ™pnie na podstawie wybranych danych wykonaÄ‡ zadanie. Na pierwszy rzut oka moÅ¼emy zauwaÅ¼yÄ‡ 3 pod zadania: rozpakowanie pliku, przetworzenie pliku CSV oraz wykonanie zadania.\nRozbicie caÅ‚ego procesu na tak maÅ‚e zadania pozwala nam na uÅ¼ycie ich w innych pipelineâ€™ach lub po prostu wykorzystanie w dowolnej klasie, ktÃ³re bÄ™dzie potrzebowaÅ‚a danej funkcji.\nImplementacja wzorca jest bardzo prosta. Klasa Pipeline musi przyjÄ…Ä‡ kolejne kroki algorytmu, ktÃ³re nastÄ™pnie musi wykonaÄ‡. MoÅ¼na to zrobiÄ‡ za jednym razem lub zbudowaÄ‡ przy pomocy metody. PrzykÅ‚adowa implementacja wzorca w jÄ™zyku PHP przedstawia siÄ™ nastÄ™pujÄ…co:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;?php class Pipeline implements PipelineInterface { /** @var callable[] */ private $stages = []; public function __construct(callable ...$stages) { $this-\u0026gt;stages = $stages; } public function pipe(callable $stage): PipelineInterface { $pipeline = clone $this; $pipeline-\u0026gt;stages[] = $stage; return $pipeline; } public function process($payload) { foreach ($this-\u0026gt;stages as $stage) { $payload = $stage($payload); } return $payload; } } Samo wykorzystanie rÃ³wnieÅ¼ jest trywialne. Musimy utworzyÄ‡ nowÄ… instancjÄ™ potoku, przekazaÄ‡ filtry (zadania) w odpowiedniej kolejnoÅ›ci i uruchomiÄ‡ proces:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php class Foo { public function __invoke(): SomeClass { $data = ...; return (new Pipeline) -\u0026gt;pipe(new FilterA) -\u0026gt;pipe(new FilterB) -\u0026gt;pipe(new FilterC) -\u0026gt;process(new SomeClass($data)); } } 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;?php class FilterA { public method __invoke(SomeClass $obj): SomeClass { // Do the magic here :). return $obj; } } Prawda, Å¼e proste?\nDajcie znaÄ‡ co myÅ›licie o wzorcu pipe \u0026amp; filters oraz jakie widzicie jego zastosowanie\n","permalink":"https://g-stawarczyk.github.io/2020/06/wzorzec-potok%C3%B3w-i-filtr%C3%B3w-pipe-filters/","summary":"CzeÅ›Ä‡.\nW moim pierwszym wpisie, chciaÅ‚bym Wam przestawiÄ‡ wzorzec architektoniczny pipe \u0026amp; filters. Jest to sposÃ³b na rozbicie duÅ¼ego zadania na mniejsze czÄ™Å›ci w bardzo przejrzysty sposÃ³b. Zaletami takiego rozwiÄ…zania jest reuÅ¼ywalnoÅ›Ä‡ klas (filtrÃ³w), moÅ¼liwoÅ›Ä‡ szybkiej zmiany krokÃ³w wykonywania danego algorytmu oraz zrÃ³wnoleglenia procesu. NiewÄ…tpliwÄ… zaletÄ… jest rÃ³wnieÅ¼ testowalnoÅ›Ä‡. DziÄ™ki wyodrÄ™bnieniu poszczegÃ³lnych moduÅ‚Ã³w moÅ¼emy, kaÅ¼dy z krokÃ³w moÅ¼emy testowaÄ‡ w izolacji, na przykÅ‚ad testami jednostkowymi.\nJeÅ›li siÄ™ nie mylÄ™, historia tego rozwiÄ…zania siÄ™ga pamiÄ™ciÄ… do 1973 roku, kiedy to jeden z pomysÅ‚Ã³w Douglasa McIlroya zostaÅ‚ zaimplementowany w systemach UNIX.","title":"Wzorzec potokÃ³w i filtrÃ³w (pipe \u0026 filters)"}]